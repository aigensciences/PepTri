dataset:
  train:
    - class: CoDesignDataset
      mmap_dir: /home/ubuntu/quang/PepGLAD/datasets/train_valid/processed
      specify_index: /home/ubuntu/quang/PepGLAD/datasets/train_valid/processed/train_index.txt
      backbone_only: false
      cluster: /home/ubuntu/quang/PepGLAD/datasets/train_valid/train.cluster
    - class: CoDesignDataset
      mmap_dir: /home/ubuntu/quang/PepGLAD/datasets/ProtFrag/processed
      backbone_only: false
  valid:
    class: CoDesignDataset
    mmap_dir: /home/ubuntu/quang/PepGLAD/datasets/train_valid/processed
    specify_index: /home/ubuntu/quang/PepGLAD/datasets/train_valid/processed/valid_index.txt
    backbone_only: false

dataloader:
  shuffle: true
  num_workers: 4
  batch_size: 16
  wrapper:
    class: DynamicBatchWrapper
    complexity: n**2
    ubound_per_batch: 60000

trainer:
  class: AutoEncoderTrainer
  config:
    max_epoch: 100
    save_topk: 10
    save_dir: ./test_simplified_run
    patience: 10
    metric_min_better: true
    grad_clip: 1.0  # Proper gradient clipping

    optimizer:
      class: AdamW
      lr: 1.0e-4
    
    scheduler:
      class: ReduceLROnPlateau
      factor: 0.8
      patience: 5
      mode: min
      frequency: val_epoch
      min_lr: 5.0e-6

model:
  class: AutoEncoder
  embed_size: 128
  hidden_size: 128
  latent_size: 8
  latent_n_channel: 1
  n_layers: 3
  n_channel: 14
  h_kl_weight: 0.3
  z_kl_weight: 0.5
  coord_loss_ratio: 0.5
  coord_loss_weights:
    Xloss: 1.0
    ca_Xloss: 1.0
    bb_bond_lengths_loss: 1.0
    sc_bond_lengths_loss: 1.0
    bb_dihedral_angles_loss: 0.0
    sc_chi_angles_loss: 0.5
  relative_position: false
  anchor_at_ca: true
  mask_ratio: 0.25
  additional_noise_scale: 0.1
  # Conservative enhanced settings
  use_spectral_norm: false  # Start without spectral norm
  n_res_blocks: 1          # Conservative: only 1 residual block
  gradient_clip_val: 1.0
  use_ema: true           # Start without EMA
  ema_decay: 0.999 